{"ast":null,"code":"var _jsxFileName = \"/home/alvin/Documents/quicktask-frontend/src/pages/Messages.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useMemo } from \"react\";\nimport { FaPaperPlane, FaPlus, FaCalendarAlt, FaNewspaper, FaSearch, FaEllipsisH, FaTrash, FaEdit, FaImage, FaFile, FaThumbsUp } from \"react-icons/fa\";\nimport { supabase } from \"../utils/supabaseClient\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Messages = ({\n  userId\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [message, setMessage] = useState(\"\");\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [users, setUsers] = useState([]);\n  const [groups, setGroups] = useState([]);\n  const [selectedGroup, setSelectedGroup] = useState(null);\n  const [newGroupName, setNewGroupName] = useState(\"\");\n  const [posts, setPosts] = useState([]);\n  const [postContent, setPostContent] = useState(\"\");\n  const [postType, setPostType] = useState(\"event\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [isEditing, setIsEditing] = useState(false);\n  const [editingMessageId, setEditingMessageId] = useState(null);\n  const [attachments, setAttachments] = useState([]);\n  const [showEmoji, setShowEmoji] = useState(false);\n  const [reactions, setReactions] = useState({});\n  const [readStatus, setReadStatus] = useState({});\n  const [isLoading, setIsLoading] = useState(true);\n  const fileInputRef = useRef(null);\n  const messagesEndRef = useRef(null);\n  useEffect(() => {\n    const fetchData = async () => {\n      setIsLoading(true);\n      try {\n        const [{\n          data: users\n        }, {\n          data: groups\n        }, {\n          data: messages\n        }, {\n          data: posts\n        }, {\n          data: reactions\n        }] = await Promise.all([supabase.from(\"users\").select(\"id, name, avatar_url, status\"), supabase.from(\"groups\").select(\"id, name, description\"), supabase.from(\"messages\").select(\"*\").order(\"created_at\", {\n          ascending: true\n        }), supabase.from(\"posts\").select(\"*\").order(\"created_at\", {\n          ascending: false\n        }), supabase.from(\"reactions\").select(\"*\")]);\n        if (users) setUsers(users);\n        if (groups) setGroups(groups);\n        if (messages) setMessages(messages);\n        if (posts) setPosts(posts);\n\n        // Convert reactions to a map for easier access\n        const reactionsMap = {};\n        reactions === null || reactions === void 0 ? void 0 : reactions.forEach(reaction => {\n          if (!reactionsMap[reaction.message_id]) {\n            reactionsMap[reaction.message_id] = [];\n          }\n          reactionsMap[reaction.message_id].push(reaction);\n        });\n        setReactions(reactionsMap);\n\n        // Initialize read status\n        const readStatusMap = {};\n        messages === null || messages === void 0 ? void 0 : messages.forEach(msg => {\n          if (msg.receiver_id === userId) {\n            readStatusMap[msg.id] = msg.read || false;\n          }\n        });\n        setReadStatus(readStatusMap);\n      } catch (error) {\n        console.error(\"Error fetching data:\", error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    fetchData();\n\n    // Real-time subscriptions\n    const messageChannel = supabase.channel(\"messages\").on(\"postgres_changes\", {\n      event: \"INSERT\",\n      schema: \"public\",\n      table: \"messages\"\n    }, payload => {\n      setMessages(prev => [...prev, payload.new]);\n      // Mark new messages as unread if they're directed to current user\n      if (payload.new.receiver_id === userId) {\n        setReadStatus(prev => ({\n          ...prev,\n          [payload.new.id]: false\n        }));\n      }\n    }).on(\"postgres_changes\", {\n      event: \"UPDATE\",\n      schema: \"public\",\n      table: \"messages\"\n    }, payload => {\n      setMessages(prev => prev.map(msg => msg.id === payload.new.id ? payload.new : msg));\n    }).on(\"postgres_changes\", {\n      event: \"DELETE\",\n      schema: \"public\",\n      table: \"messages\"\n    }, payload => {\n      setMessages(prev => prev.filter(msg => msg.id !== payload.old.id));\n    }).subscribe();\n    const postChannel = supabase.channel(\"posts\").on(\"postgres_changes\", {\n      event: \"INSERT\",\n      schema: \"public\",\n      table: \"posts\"\n    }, payload => {\n      setPosts(prev => [payload.new, ...prev]);\n    }).subscribe();\n    const reactionChannel = supabase.channel(\"reactions\").on(\"postgres_changes\", {\n      event: \"*\",\n      schema: \"public\",\n      table: \"reactions\"\n    }, payload => {\n      fetchReactions();\n    }).subscribe();\n    return () => {\n      supabase.removeChannel(messageChannel);\n      supabase.removeChannel(postChannel);\n      supabase.removeChannel(reactionChannel);\n    };\n  }, [userId]);\n  const fetchReactions = async () => {\n    const {\n      data\n    } = await supabase.from(\"reactions\").select(\"*\");\n    const reactionsMap = {};\n    data === null || data === void 0 ? void 0 : data.forEach(reaction => {\n      if (!reactionsMap[reaction.message_id]) {\n        reactionsMap[reaction.message_id] = [];\n      }\n      reactionsMap[reaction.message_id].push(reaction);\n    });\n    setReactions(reactionsMap);\n  };\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  useEffect(() => {\n    // Mark messages as read when conversation is selected\n    if (selectedUser || selectedGroup) {\n      const markAsRead = async () => {\n        const messagesToUpdate = messages.filter(msg => msg.receiver_id === userId && !readStatus[msg.id] && (selectedUser ? msg.sender_id === selectedUser.id : msg.group_id === selectedGroup.id));\n        if (messagesToUpdate.length > 0) {\n          const ids = messagesToUpdate.map(msg => msg.id);\n          await supabase.from(\"messages\").update({\n            read: true\n          }).in(\"id\", ids);\n          const newReadStatus = {\n            ...readStatus\n          };\n          ids.forEach(id => {\n            newReadStatus[id] = true;\n          });\n          setReadStatus(newReadStatus);\n        }\n      };\n      markAsRead();\n    }\n  }, [selectedUser, selectedGroup, messages, userId, readStatus]);\n  const sendMessage = async () => {\n    if (!message.trim() && attachments.length === 0 || !selectedUser && !selectedGroup) return;\n    try {\n      let attachmentUrls = [];\n\n      // Upload attachments if any\n      if (attachments.length > 0) {\n        attachmentUrls = await Promise.all(attachments.map(async file => {\n          const fileName = `${Date.now()}-${file.name}`;\n          const {\n            data,\n            error\n          } = await supabase.storage.from(\"attachments\").upload(fileName, file);\n          if (error) throw error;\n          return {\n            name: file.name,\n            url: `${process.env.NEXT_PUBLIC_SUPABASE_URL}/storage/v1/object/public/attachments/${fileName}`,\n            type: file.type\n          };\n        }));\n      }\n      const newMessage = {\n        sender_id: userId,\n        receiver_id: selectedUser ? selectedUser.id : null,\n        group_id: selectedGroup ? selectedGroup.id : null,\n        content: message.trim(),\n        attachments: attachmentUrls.length > 0 ? attachmentUrls : null,\n        created_at: new Date().toISOString(),\n        read: false\n      };\n      if (isEditing && editingMessageId) {\n        await supabase.from(\"messages\").update({\n          content: message\n        }).eq(\"id\", editingMessageId);\n        setIsEditing(false);\n        setEditingMessageId(null);\n      } else {\n        await supabase.from(\"messages\").insert([newMessage]);\n      }\n      setMessage(\"\");\n      setAttachments([]);\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n    }\n  };\n  const handleFileUpload = e => {\n    const files = Array.from(e.target.files);\n    setAttachments(prev => [...prev, ...files]);\n  };\n  const removeAttachment = index => {\n    setAttachments(prev => prev.filter((_, i) => i !== index));\n  };\n  const editMessage = msg => {\n    setMessage(msg.content);\n    setIsEditing(true);\n    setEditingMessageId(msg.id);\n  };\n  const deleteMessage = async id => {\n    try {\n      await supabase.from(\"messages\").delete().eq(\"id\", id);\n    } catch (error) {\n      console.error(\"Error deleting message:\", error);\n    }\n  };\n  const addReaction = async (messageId, emoji) => {\n    try {\n      await supabase.from(\"reactions\").insert([{\n        user_id: userId,\n        message_id: messageId,\n        emoji: emoji\n      }]);\n    } catch (error) {\n      console.error(\"Error adding reaction:\", error);\n    }\n  };\n  const createGroup = async () => {\n    if (!newGroupName.trim()) return;\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from(\"groups\").insert([{\n        name: newGroupName,\n        description: \"\",\n        created_by: userId,\n        created_at: new Date().toISOString()\n      }]).select();\n      if (!error) {\n        setGroups(prev => [...prev, ...data]);\n        setNewGroupName(\"\");\n      }\n    } catch (error) {\n      console.error(\"Error creating group:\", error);\n    }\n  };\n  const postUpdate = async () => {\n    if (!postContent.trim()) return;\n    try {\n      const newPost = {\n        user_id: userId,\n        content: postContent,\n        type: postType,\n        created_at: new Date().toISOString()\n      };\n      await supabase.from(\"posts\").insert([newPost]);\n      setPostContent(\"\");\n    } catch (error) {\n      console.error(\"Error posting update:\", error);\n    }\n  };\n  const filteredMessages = useMemo(() => {\n    const filtered = messages.filter(msg => selectedUser ? msg.sender_id === userId && msg.receiver_id === selectedUser.id || msg.sender_id === selectedUser.id && msg.receiver_id === userId : selectedGroup ? msg.group_id === selectedGroup.id : false);\n    if (searchTerm) {\n      return filtered.filter(msg => msg.content.toLowerCase().includes(searchTerm.toLowerCase()));\n    }\n    return filtered;\n  }, [messages, selectedUser, selectedGroup, userId, searchTerm]);\n  const filteredUsers = useMemo(() => {\n    if (!searchTerm) return users.filter(u => u.id !== userId);\n    return users.filter(u => u.id !== userId && u.name.toLowerCase().includes(searchTerm.toLowerCase()));\n  }, [users, searchTerm, userId]);\n  const filteredGroups = useMemo(() => {\n    if (!searchTerm) return groups;\n    return groups.filter(g => g.name.toLowerCase().includes(searchTerm.toLowerCase()));\n  }, [groups, searchTerm]);\n  const filteredPosts = useMemo(() => {\n    if (!searchTerm) return posts;\n    return posts.filter(p => p.content.toLowerCase().includes(searchTerm.toLowerCase()));\n  }, [posts, searchTerm]);\n  const getUnreadCount = (targetId, isGroup = false) => {\n    return messages.filter(msg => msg.receiver_id === userId && !readStatus[msg.id] && (isGroup ? msg.group_id === targetId : msg.sender_id === targetId)).length;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex h-screen max-w-6xl mx-auto bg-gray-50 border rounded-lg shadow-md\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-1/3 border-r p-4 overflow-y-auto bg-white\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-lg font-bold mb-4\",\n        children: \"Messages\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative mb-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Search...\",\n          className: \"w-full p-2 pl-8 border rounded\",\n          value: searchTerm,\n          onChange: e => setSearchTerm(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FaSearch, {\n          className: \"absolute left-2 top-3 text-gray-400\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"font-semibold mb-2\",\n        children: \"Direct Messages\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 9\n      }, this), isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"animate-pulse space-y-2\",\n        children: [1, 2, 3].map(i => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-12 bg-gray-200 rounded-lg\"\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 11\n      }, this) : filteredUsers.map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `p-3 mb-2 cursor-pointer rounded-lg flex items-center justify-between ${(selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.id) === user.id ? \"bg-blue-500 text-white\" : \"hover:bg-gray-200\"}`,\n        onClick: () => {\n          setSelectedUser(user);\n          setSelectedGroup(null);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-8 h-8 bg-gray-300 rounded-full mr-2 flex items-center justify-center\",\n            children: user.avatar_url ? /*#__PURE__*/_jsxDEV(\"img\", {\n              src: user.avatar_url,\n              alt: user.name,\n              className: \"w-8 h-8 rounded-full\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 362,\n              columnNumber: 21\n            }, this) : user.name.charAt(0).toUpperCase()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: user.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 367,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 359,\n          columnNumber: 15\n        }, this), getUnreadCount(user.id) > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"bg-red-500 text-white text-xs rounded-full px-2 py-1\",\n          children: getUnreadCount(user.id)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 17\n        }, this)]\n      }, user.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 13\n      }, this)), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"font-semibold mt-6 mb-2 flex items-center justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Groups\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 380,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FaPlus, {\n          className: \"text-blue-500 cursor-pointer\",\n          onClick: () => document.getElementById('new-group-form').classList.toggle('hidden')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 9\n      }, this), isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"animate-pulse space-y-2\",\n        children: [1, 2].map(i => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-12 bg-gray-200 rounded-lg\"\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 390,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 11\n      }, this) : filteredGroups.map(group => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `p-3 mb-2 cursor-pointer rounded-lg flex items-center justify-between ${(selectedGroup === null || selectedGroup === void 0 ? void 0 : selectedGroup.id) === group.id ? \"bg-green-500 text-white\" : \"hover:bg-gray-200\"}`,\n        onClick: () => {\n          setSelectedGroup(group);\n          setSelectedUser(null);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: group.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 406,\n            columnNumber: 17\n          }, this), group.description && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: `text-xs ${(selectedGroup === null || selectedGroup === void 0 ? void 0 : selectedGroup.id) === group.id ? \"text-white\" : \"text-gray-500\"}`,\n            children: group.description\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 408,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 15\n        }, this), getUnreadCount(group.id, true) > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"bg-red-500 text-white text-xs rounded-full px-2 py-1\",\n          children: getUnreadCount(group.id, true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 17\n        }, this)]\n      }, group.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 13\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"new-group-form\",\n        className: \"mt-4 hidden\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"New group name...\",\n          className: \"p-2 border rounded w-full mb-2\",\n          value: newGroupName,\n          onChange: e => setNewGroupName(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 424,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"w-full bg-green-600 text-white p-2 rounded\",\n          onClick: createGroup,\n          children: \"Create Group\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 423,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 flex flex-col\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 bg-blue-600 text-white flex justify-between items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"font-bold text-lg\",\n          children: selectedUser ? selectedUser.name : selectedGroup ? `Group: ${selectedGroup.name}` : \"Select a conversation\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 443,\n          columnNumber: 11\n        }, this), (selectedUser || selectedGroup) && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: /*#__PURE__*/_jsxDEV(FaEllipsisH, {\n            className: \"cursor-pointer\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 448,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 442,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 p-4 overflow-y-auto bg-gray-100\",\n        children: [isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-pulse space-y-3\",\n          children: [1, 2, 3, 4].map(i => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `h-16 ${i % 2 === 0 ? 'ml-auto w-2/3' : 'w-2/3'} bg-gray-200 rounded-lg`\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 458,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 13\n        }, this) : filteredMessages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col items-center justify-center h-full text-gray-500\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: searchTerm ? \"No messages match your search\" : \"No messages yet\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 463,\n            columnNumber: 15\n          }, this), !searchTerm && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm\",\n            children: \"Start the conversation!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 464,\n            columnNumber: 31\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 462,\n          columnNumber: 13\n        }, this) : filteredMessages.map(msg => {\n          var _users$find;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `p-3 rounded-lg max-w-xs ${msg.sender_id === userId ? \"ml-auto bg-blue-500 text-white\" : \"bg-white border\"}`,\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-between items-center mb-1\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm font-semibold\",\n                  children: msg.sender_id === userId ? \"You\" : (_users$find = users.find(u => u.id === msg.sender_id)) === null || _users$find === void 0 ? void 0 : _users$find.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 477,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-xs opacity-75\",\n                  children: new Date(msg.created_at).toLocaleTimeString([], {\n                    hour: '2-digit',\n                    minute: '2-digit'\n                  })\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 482,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 476,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: msg.content\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 487,\n                columnNumber: 19\n              }, this), msg.attachments && msg.attachments.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mt-2 space-y-1\",\n                children: msg.attachments.map((attachment, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center\",\n                  children: [attachment.type.startsWith('image') ? /*#__PURE__*/_jsxDEV(FaImage, {\n                    className: \"mr-1\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 494,\n                    columnNumber: 29\n                  }, this) : /*#__PURE__*/_jsxDEV(FaFile, {\n                    className: \"mr-1\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 496,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                    href: attachment.url,\n                    target: \"_blank\",\n                    rel: \"noreferrer\",\n                    className: \"text-sm underline\",\n                    children: attachment.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 498,\n                    columnNumber: 27\n                  }, this)]\n                }, index, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 492,\n                  columnNumber: 25\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 490,\n                columnNumber: 21\n              }, this), reactions[msg.id] && reactions[msg.id].length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mt-2 flex flex-wrap gap-1\",\n                children: reactions[msg.id].map((reaction, index) => /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"bg-gray-200 text-black rounded-full px-2 py-0.5 text-xs\",\n                  children: [reaction.emoji, \" \", reaction.emoji === 'ðŸ‘' ? reactions[msg.id].filter(r => r.emoji === 'ðŸ‘').length : '']\n                }, index, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 515,\n                  columnNumber: 25\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 513,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 469,\n              columnNumber: 17\n            }, this), msg.sender_id === userId && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-end mt-1 space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"text-xs text-gray-500 hover:text-gray-700\",\n                onClick: () => editMessage(msg),\n                children: /*#__PURE__*/_jsxDEV(FaEdit, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 530,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 526,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"text-xs text-gray-500 hover:text-red-500\",\n                onClick: () => deleteMessage(msg.id),\n                children: /*#__PURE__*/_jsxDEV(FaTrash, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 536,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 532,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 525,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-start mt-1\",\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"text-xs text-gray-500 hover:text-blue-500\",\n                onClick: () => addReaction(msg.id, 'ðŸ‘'),\n                children: /*#__PURE__*/_jsxDEV(FaThumbsUp, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 547,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 543,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 542,\n              columnNumber: 17\n            }, this)]\n          }, msg.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 468,\n            columnNumber: 15\n          }, this);\n        }), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 553,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 454,\n        columnNumber: 9\n      }, this), attachments.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"px-3 pt-2 bg-gray-100 flex gap-2 flex-wrap\",\n        children: attachments.map((file, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative bg-white p-1 rounded border flex items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-xs truncate max-w-xs\",\n            children: file.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 561,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"ml-1 text-red-500\",\n            onClick: () => removeAttachment(index),\n            children: /*#__PURE__*/_jsxDEV(FaTrash, {\n              size: 10\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 566,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 562,\n            columnNumber: 17\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 560,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 558,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center p-3 border-t bg-white\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"text-gray-500 p-2\",\n          onClick: () => {\n            var _fileInputRef$current;\n            return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n          },\n          children: [/*#__PURE__*/_jsxDEV(FaImage, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 579,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            className: \"hidden\",\n            ref: fileInputRef,\n            onChange: handleFileUpload,\n            multiple: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 580,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 575,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"flex-1 border p-2 rounded-md outline-none mx-2\",\n          placeholder: isEditing ? \"Edit your message...\" : \"Type a message...\",\n          value: message,\n          onChange: e => setMessage(e.target.value),\n          onKeyPress: e => e.key === 'Enter' && sendMessage()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 589,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: sendMessage,\n          className: `${isEditing ? \"bg-yellow-600\" : \"bg-blue-600\"} text-white p-2 rounded-md`,\n          children: /*#__PURE__*/_jsxDEV(FaPaperPlane, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 604,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 598,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 574,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 441,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-1/3 p-4 border-l bg-white overflow-y-auto\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-lg font-bold mb-4\",\n        children: \"Events & Newsletters\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 611,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n          className: \"w-full border p-2 rounded\",\n          placeholder: \"Write something...\",\n          rows: \"4\",\n          value: postContent,\n          onChange: e => setPostContent(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 614,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex gap-2 mb-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `flex-1 p-2 rounded ${postType === \"event\" ? \"bg-blue-600 text-white\" : \"bg-gray-200\"}`,\n            onClick: () => setPostType(\"event\"),\n            children: [/*#__PURE__*/_jsxDEV(FaCalendarAlt, {\n              className: \"mr-2 inline\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 627,\n              columnNumber: 15\n            }, this), \" Event\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 623,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `flex-1 p-2 rounded ${postType === \"newsletter\" ? \"bg-blue-600 text-white\" : \"bg-gray-200\"}`,\n            onClick: () => setPostType(\"newsletter\"),\n            children: [/*#__PURE__*/_jsxDEV(FaNewspaper, {\n              className: \"mr-2 inline\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 633,\n              columnNumber: 15\n            }, this), \" Newsletter\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 629,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 622,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"w-full bg-blue-600 text-white p-2 rounded\",\n          onClick: postUpdate,\n          children: \"Post\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 637,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 613,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-4\",\n        children: isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-pulse space-y-3\",\n          children: [1, 2, 3].map(i => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-32 bg-gray-200 rounded-lg\"\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 649,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 647,\n          columnNumber: 13\n        }, this) : filteredPosts.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center text-gray-500 py-4\",\n          children: [\"No posts available \", searchTerm && \"matching your search\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 653,\n          columnNumber: 13\n        }, this) : filteredPosts.map(post => {\n          var _users$find2, _users$find3;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"border rounded-lg p-3 bg-gray-50\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex justify-between items-center mb-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-8 h-8 bg-gray-300 rounded-full mr-2 flex items-center justify-center\",\n                  children: (_users$find2 = users.find(u => u.id === post.user_id)) === null || _users$find2 === void 0 ? void 0 : _users$find2.name.charAt(0).toUpperCase()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 661,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                    className: \"font-semibold\",\n                    children: (_users$find3 = users.find(u => u.id === post.user_id)) === null || _users$find3 === void 0 ? void 0 : _users$find3.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 665,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    className: \"text-xs text-gray-500\",\n                    children: new Date(post.created_at).toLocaleDateString()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 666,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 664,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 660,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: `text-xs px-2 py-1 rounded ${post.type === \"event\" ? \"bg-blue-100 text-blue-800\" : \"bg-green-100 text-green-800\"}`,\n                children: post.type === \"event\" ? \"Event\" : \"Newsletter\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 671,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 659,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"whitespace-pre-line\",\n              children: post.content\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 677,\n              columnNumber: 17\n            }, this)]\n          }, post.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 658,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 645,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 610,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 322,\n    columnNumber: 5\n  }, this);\n};\n_s(Messages, \"KFv8NInpBq1SX5EMP//kzDgnNuY=\");\n_c = Messages;\nexport default Messages;\nvar _c;\n$RefreshReg$(_c, \"Messages\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useMemo","FaPaperPlane","FaPlus","FaCalendarAlt","FaNewspaper","FaSearch","FaEllipsisH","FaTrash","FaEdit","FaImage","FaFile","FaThumbsUp","supabase","jsxDEV","_jsxDEV","Messages","userId","_s","messages","setMessages","message","setMessage","selectedUser","setSelectedUser","users","setUsers","groups","setGroups","selectedGroup","setSelectedGroup","newGroupName","setNewGroupName","posts","setPosts","postContent","setPostContent","postType","setPostType","searchTerm","setSearchTerm","isEditing","setIsEditing","editingMessageId","setEditingMessageId","attachments","setAttachments","showEmoji","setShowEmoji","reactions","setReactions","readStatus","setReadStatus","isLoading","setIsLoading","fileInputRef","messagesEndRef","fetchData","data","Promise","all","from","select","order","ascending","reactionsMap","forEach","reaction","message_id","push","readStatusMap","msg","receiver_id","id","read","error","console","messageChannel","channel","on","event","schema","table","payload","prev","new","map","filter","old","subscribe","postChannel","reactionChannel","fetchReactions","removeChannel","_messagesEndRef$curre","current","scrollIntoView","behavior","markAsRead","messagesToUpdate","sender_id","group_id","length","ids","update","in","newReadStatus","sendMessage","trim","attachmentUrls","file","fileName","Date","now","name","storage","upload","url","process","env","NEXT_PUBLIC_SUPABASE_URL","type","newMessage","content","created_at","toISOString","eq","insert","handleFileUpload","e","files","Array","target","removeAttachment","index","_","i","editMessage","deleteMessage","delete","addReaction","messageId","emoji","user_id","createGroup","description","created_by","postUpdate","newPost","filteredMessages","filtered","toLowerCase","includes","filteredUsers","u","filteredGroups","g","filteredPosts","p","getUnreadCount","targetId","isGroup","className","children","_jsxFileName","lineNumber","columnNumber","placeholder","value","onChange","user","onClick","avatar_url","src","alt","charAt","toUpperCase","document","getElementById","classList","toggle","group","_users$find","find","toLocaleTimeString","hour","minute","attachment","startsWith","href","rel","r","ref","size","_fileInputRef$current","click","multiple","onKeyPress","key","rows","post","_users$find2","_users$find3","toLocaleDateString","_c","$RefreshReg$"],"sources":["/home/alvin/Documents/quicktask-frontend/src/pages/Messages.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useMemo } from \"react\";\nimport { FaPaperPlane, FaPlus, FaCalendarAlt, FaNewspaper, FaSearch, FaEllipsisH, FaTrash, FaEdit, FaImage, FaFile, FaThumbsUp } from \"react-icons/fa\";\nimport {supabase} from \"../utils/supabaseClient\";\n\nconst Messages = ({ userId }) => {\n  const [messages, setMessages] = useState([]);\n  const [message, setMessage] = useState(\"\");\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [users, setUsers] = useState([]);\n  const [groups, setGroups] = useState([]);\n  const [selectedGroup, setSelectedGroup] = useState(null);\n  const [newGroupName, setNewGroupName] = useState(\"\");\n  const [posts, setPosts] = useState([]);\n  const [postContent, setPostContent] = useState(\"\");\n  const [postType, setPostType] = useState(\"event\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [isEditing, setIsEditing] = useState(false);\n  const [editingMessageId, setEditingMessageId] = useState(null);\n  const [attachments, setAttachments] = useState([]);\n  const [showEmoji, setShowEmoji] = useState(false);\n  const [reactions, setReactions] = useState({});\n  const [readStatus, setReadStatus] = useState({});\n  const [isLoading, setIsLoading] = useState(true);\n  const fileInputRef = useRef(null);\n  const messagesEndRef = useRef(null);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      setIsLoading(true);\n      try {\n        const [{ data: users }, { data: groups }, { data: messages }, { data: posts }, { data: reactions }] = await Promise.all([\n          supabase.from(\"users\").select(\"id, name, avatar_url, status\"),\n          supabase.from(\"groups\").select(\"id, name, description\"),\n          supabase.from(\"messages\").select(\"*\").order(\"created_at\", { ascending: true }),\n          supabase.from(\"posts\").select(\"*\").order(\"created_at\", { ascending: false }),\n          supabase.from(\"reactions\").select(\"*\"),\n        ]);\n\n        if (users) setUsers(users);\n        if (groups) setGroups(groups);\n        if (messages) setMessages(messages);\n        if (posts) setPosts(posts);\n        \n        // Convert reactions to a map for easier access\n        const reactionsMap = {};\n        reactions?.forEach(reaction => {\n          if (!reactionsMap[reaction.message_id]) {\n            reactionsMap[reaction.message_id] = [];\n          }\n          reactionsMap[reaction.message_id].push(reaction);\n        });\n        setReactions(reactionsMap);\n        \n        // Initialize read status\n        const readStatusMap = {};\n        messages?.forEach(msg => {\n          if (msg.receiver_id === userId) {\n            readStatusMap[msg.id] = msg.read || false;\n          }\n        });\n        setReadStatus(readStatusMap);\n      } catch (error) {\n        console.error(\"Error fetching data:\", error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchData();\n\n    // Real-time subscriptions\n    const messageChannel = supabase\n      .channel(\"messages\")\n      .on(\"postgres_changes\", { event: \"INSERT\", schema: \"public\", table: \"messages\" }, (payload) => {\n        setMessages((prev) => [...prev, payload.new]);\n        // Mark new messages as unread if they're directed to current user\n        if (payload.new.receiver_id === userId) {\n          setReadStatus(prev => ({ ...prev, [payload.new.id]: false }));\n        }\n      })\n      .on(\"postgres_changes\", { event: \"UPDATE\", schema: \"public\", table: \"messages\" }, (payload) => {\n        setMessages((prev) => prev.map(msg => msg.id === payload.new.id ? payload.new : msg));\n      })\n      .on(\"postgres_changes\", { event: \"DELETE\", schema: \"public\", table: \"messages\" }, (payload) => {\n        setMessages((prev) => prev.filter(msg => msg.id !== payload.old.id));\n      })\n      .subscribe();\n\n    const postChannel = supabase\n      .channel(\"posts\")\n      .on(\"postgres_changes\", { event: \"INSERT\", schema: \"public\", table: \"posts\" }, (payload) => {\n        setPosts((prev) => [payload.new, ...prev]);\n      })\n      .subscribe();\n\n    const reactionChannel = supabase\n      .channel(\"reactions\")\n      .on(\"postgres_changes\", { event: \"*\", schema: \"public\", table: \"reactions\" }, (payload) => {\n        fetchReactions();\n      })\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(messageChannel);\n      supabase.removeChannel(postChannel);\n      supabase.removeChannel(reactionChannel);\n    };\n  }, [userId]);\n\n  const fetchReactions = async () => {\n    const { data } = await supabase.from(\"reactions\").select(\"*\");\n    const reactionsMap = {};\n    data?.forEach(reaction => {\n      if (!reactionsMap[reaction.message_id]) {\n        reactionsMap[reaction.message_id] = [];\n      }\n      reactionsMap[reaction.message_id].push(reaction);\n    });\n    setReactions(reactionsMap);\n  };\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  useEffect(() => {\n    // Mark messages as read when conversation is selected\n    if (selectedUser || selectedGroup) {\n      const markAsRead = async () => {\n        const messagesToUpdate = messages.filter(msg => \n          msg.receiver_id === userId && !readStatus[msg.id] &&\n          (selectedUser ? msg.sender_id === selectedUser.id : msg.group_id === selectedGroup.id)\n        );\n        \n        if (messagesToUpdate.length > 0) {\n          const ids = messagesToUpdate.map(msg => msg.id);\n          await supabase.from(\"messages\").update({ read: true }).in(\"id\", ids);\n          \n          const newReadStatus = { ...readStatus };\n          ids.forEach(id => { newReadStatus[id] = true; });\n          setReadStatus(newReadStatus);\n        }\n      };\n      markAsRead();\n    }\n  }, [selectedUser, selectedGroup, messages, userId, readStatus]);\n\n  const sendMessage = async () => {\n    if ((!message.trim() && attachments.length === 0) || (!selectedUser && !selectedGroup)) return;\n\n    try {\n      let attachmentUrls = [];\n      \n      // Upload attachments if any\n      if (attachments.length > 0) {\n        attachmentUrls = await Promise.all(\n          attachments.map(async (file) => {\n            const fileName = `${Date.now()}-${file.name}`;\n            const { data, error } = await supabase.storage\n              .from(\"attachments\")\n              .upload(fileName, file);\n              \n            if (error) throw error;\n            \n            return {\n              name: file.name,\n              url: `${process.env.NEXT_PUBLIC_SUPABASE_URL}/storage/v1/object/public/attachments/${fileName}`,\n              type: file.type\n            };\n          })\n        );\n      }\n\n      const newMessage = {\n        sender_id: userId,\n        receiver_id: selectedUser ? selectedUser.id : null,\n        group_id: selectedGroup ? selectedGroup.id : null,\n        content: message.trim(),\n        attachments: attachmentUrls.length > 0 ? attachmentUrls : null,\n        created_at: new Date().toISOString(),\n        read: false,\n      };\n\n      if (isEditing && editingMessageId) {\n        await supabase.from(\"messages\").update({ content: message }).eq(\"id\", editingMessageId);\n        setIsEditing(false);\n        setEditingMessageId(null);\n      } else {\n        await supabase.from(\"messages\").insert([newMessage]);\n      }\n      \n      setMessage(\"\");\n      setAttachments([]);\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n    }\n  };\n\n  const handleFileUpload = (e) => {\n    const files = Array.from(e.target.files);\n    setAttachments(prev => [...prev, ...files]);\n  };\n\n  const removeAttachment = (index) => {\n    setAttachments(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const editMessage = (msg) => {\n    setMessage(msg.content);\n    setIsEditing(true);\n    setEditingMessageId(msg.id);\n  };\n\n  const deleteMessage = async (id) => {\n    try {\n      await supabase.from(\"messages\").delete().eq(\"id\", id);\n    } catch (error) {\n      console.error(\"Error deleting message:\", error);\n    }\n  };\n\n  const addReaction = async (messageId, emoji) => {\n    try {\n      await supabase.from(\"reactions\").insert([{\n        user_id: userId,\n        message_id: messageId,\n        emoji: emoji\n      }]);\n    } catch (error) {\n      console.error(\"Error adding reaction:\", error);\n    }\n  };\n\n  const createGroup = async () => {\n    if (!newGroupName.trim()) return;\n\n    try {\n      const { data, error } = await supabase.from(\"groups\").insert([{ \n        name: newGroupName,\n        description: \"\",\n        created_by: userId,\n        created_at: new Date().toISOString()\n      }]).select();\n      \n      if (!error) {\n        setGroups((prev) => [...prev, ...data]);\n        setNewGroupName(\"\");\n      }\n    } catch (error) {\n      console.error(\"Error creating group:\", error);\n    }\n  };\n\n  const postUpdate = async () => {\n    if (!postContent.trim()) return;\n\n    try {\n      const newPost = {\n        user_id: userId,\n        content: postContent,\n        type: postType,\n        created_at: new Date().toISOString(),\n      };\n\n      await supabase.from(\"posts\").insert([newPost]);\n      setPostContent(\"\");\n    } catch (error) {\n      console.error(\"Error posting update:\", error);\n    }\n  };\n\n  const filteredMessages = useMemo(() => {\n    const filtered = messages.filter(\n      (msg) =>\n        selectedUser\n          ? (msg.sender_id === userId && msg.receiver_id === selectedUser.id) || \n            (msg.sender_id === selectedUser.id && msg.receiver_id === userId)\n          : selectedGroup\n          ? msg.group_id === selectedGroup.id\n          : false\n    );\n    \n    if (searchTerm) {\n      return filtered.filter(msg => \n        msg.content.toLowerCase().includes(searchTerm.toLowerCase())\n      );\n    }\n    \n    return filtered;\n  }, [messages, selectedUser, selectedGroup, userId, searchTerm]);\n\n  const filteredUsers = useMemo(() => {\n    if (!searchTerm) return users.filter(u => u.id !== userId);\n    return users.filter(u => \n      u.id !== userId && \n      u.name.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n  }, [users, searchTerm, userId]);\n\n  const filteredGroups = useMemo(() => {\n    if (!searchTerm) return groups;\n    return groups.filter(g => \n      g.name.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n  }, [groups, searchTerm]);\n\n  const filteredPosts = useMemo(() => {\n    if (!searchTerm) return posts;\n    return posts.filter(p => \n      p.content.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n  }, [posts, searchTerm]);\n\n  const getUnreadCount = (targetId, isGroup = false) => {\n    return messages.filter(msg => \n      msg.receiver_id === userId && !readStatus[msg.id] && \n      (isGroup ? msg.group_id === targetId : msg.sender_id === targetId)\n    ).length;\n  };\n\n  return (\n    <div className=\"flex h-screen max-w-6xl mx-auto bg-gray-50 border rounded-lg shadow-md\">\n      {/* Sidebar */}\n      <div className=\"w-1/3 border-r p-4 overflow-y-auto bg-white\">\n        <h2 className=\"text-lg font-bold mb-4\">Messages</h2>\n        \n        {/* Search */}\n        <div className=\"relative mb-4\">\n          <input\n            type=\"text\"\n            placeholder=\"Search...\"\n            className=\"w-full p-2 pl-8 border rounded\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n          <FaSearch className=\"absolute left-2 top-3 text-gray-400\" />\n        </div>\n\n        {/* Users List */}\n        <h3 className=\"font-semibold mb-2\">Direct Messages</h3>\n        {isLoading ? (\n          <div className=\"animate-pulse space-y-2\">\n            {[1, 2, 3].map(i => (\n              <div key={i} className=\"h-12 bg-gray-200 rounded-lg\"></div>\n            ))}\n          </div>\n        ) : (\n          filteredUsers.map((user) => (\n            <div\n              key={user.id}\n              className={`p-3 mb-2 cursor-pointer rounded-lg flex items-center justify-between ${\n                selectedUser?.id === user.id ? \"bg-blue-500 text-white\" : \"hover:bg-gray-200\"\n              }`}\n              onClick={() => {\n                setSelectedUser(user);\n                setSelectedGroup(null);\n              }}\n            >\n              <div className=\"flex items-center\">\n                <div className=\"w-8 h-8 bg-gray-300 rounded-full mr-2 flex items-center justify-center\">\n                  {user.avatar_url ? (\n                    <img src={user.avatar_url} alt={user.name} className=\"w-8 h-8 rounded-full\" />\n                  ) : (\n                    user.name.charAt(0).toUpperCase()\n                  )}\n                </div>\n                <span>{user.name}</span>\n              </div>\n              {getUnreadCount(user.id) > 0 && (\n                <span className=\"bg-red-500 text-white text-xs rounded-full px-2 py-1\">\n                  {getUnreadCount(user.id)}\n                </span>\n              )}\n            </div>\n          ))\n        )}\n\n        {/* Groups List */}\n        <h3 className=\"font-semibold mt-6 mb-2 flex items-center justify-between\">\n          <span>Groups</span>\n          <FaPlus \n            className=\"text-blue-500 cursor-pointer\" \n            onClick={() => document.getElementById('new-group-form').classList.toggle('hidden')}\n          />\n        </h3>\n        \n        {isLoading ? (\n          <div className=\"animate-pulse space-y-2\">\n            {[1, 2].map(i => (\n              <div key={i} className=\"h-12 bg-gray-200 rounded-lg\"></div>\n            ))}\n          </div>\n        ) : (\n          filteredGroups.map((group) => (\n            <div\n              key={group.id}\n              className={`p-3 mb-2 cursor-pointer rounded-lg flex items-center justify-between ${\n                selectedGroup?.id === group.id ? \"bg-green-500 text-white\" : \"hover:bg-gray-200\"\n              }`}\n              onClick={() => {\n                setSelectedGroup(group);\n                setSelectedUser(null);\n              }}\n            >\n              <div>\n                <span>{group.name}</span>\n                {group.description && (\n                  <p className={`text-xs ${selectedGroup?.id === group.id ? \"text-white\" : \"text-gray-500\"}`}>\n                    {group.description}\n                  </p>\n                )}\n              </div>\n              {getUnreadCount(group.id, true) > 0 && (\n                <span className=\"bg-red-500 text-white text-xs rounded-full px-2 py-1\">\n                  {getUnreadCount(group.id, true)}\n                </span>\n              )}\n            </div>\n          ))\n        )}\n\n        {/* Create Group Form */}\n        <div id=\"new-group-form\" className=\"mt-4 hidden\">\n          <input\n            type=\"text\"\n            placeholder=\"New group name...\"\n            className=\"p-2 border rounded w-full mb-2\"\n            value={newGroupName}\n            onChange={(e) => setNewGroupName(e.target.value)}\n          />\n          <button \n            className=\"w-full bg-green-600 text-white p-2 rounded\" \n            onClick={createGroup}\n          >\n            Create Group\n          </button>\n        </div>\n      </div>\n\n      {/* Chat Window */}\n      <div className=\"flex-1 flex flex-col\">\n        <div className=\"p-4 bg-blue-600 text-white flex justify-between items-center\">\n          <h2 className=\"font-bold text-lg\">\n            {selectedUser ? selectedUser.name : selectedGroup ? `Group: ${selectedGroup.name}` : \"Select a conversation\"}\n          </h2>\n          {(selectedUser || selectedGroup) && (\n            <div className=\"relative\">\n              <FaEllipsisH className=\"cursor-pointer\" />\n              {/* Dropdown menu for more options could go here */}\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex-1 p-4 overflow-y-auto bg-gray-100\">\n          {isLoading ? (\n            <div className=\"animate-pulse space-y-3\">\n              {[1, 2, 3, 4].map(i => (\n                <div key={i} className={`h-16 ${i % 2 === 0 ? 'ml-auto w-2/3' : 'w-2/3'} bg-gray-200 rounded-lg`}></div>\n              ))}\n            </div>\n          ) : filteredMessages.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-full text-gray-500\">\n              <p>{searchTerm ? \"No messages match your search\" : \"No messages yet\"}</p>\n              {!searchTerm && <p className=\"text-sm\">Start the conversation!</p>}\n            </div>\n          ) : (\n            filteredMessages.map((msg) => (\n              <div key={msg.id} className=\"mb-4\">\n                <div \n                  className={`p-3 rounded-lg max-w-xs ${\n                    msg.sender_id === userId \n                      ? \"ml-auto bg-blue-500 text-white\" \n                      : \"bg-white border\"\n                  }`}\n                >\n                  <div className=\"flex justify-between items-center mb-1\">\n                    <p className=\"text-sm font-semibold\">\n                      {msg.sender_id === userId \n                        ? \"You\" \n                        : users.find(u => u.id === msg.sender_id)?.name}\n                    </p>\n                    <p className=\"text-xs opacity-75\">\n                      {new Date(msg.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}\n                    </p>\n                  </div>\n                  \n                  <p>{msg.content}</p>\n                  \n                  {msg.attachments && msg.attachments.length > 0 && (\n                    <div className=\"mt-2 space-y-1\">\n                      {msg.attachments.map((attachment, index) => (\n                        <div key={index} className=\"flex items-center\">\n                          {attachment.type.startsWith('image') ? (\n                            <FaImage className=\"mr-1\" />\n                          ) : (\n                            <FaFile className=\"mr-1\" />\n                          )}\n                          <a \n                            href={attachment.url} \n                            target=\"_blank\" \n                            rel=\"noreferrer\" \n                            className=\"text-sm underline\"\n                          >\n                            {attachment.name}\n                          </a>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  \n                  {/* Reactions */}\n                  {reactions[msg.id] && reactions[msg.id].length > 0 && (\n                    <div className=\"mt-2 flex flex-wrap gap-1\">\n                      {reactions[msg.id].map((reaction, index) => (\n                        <span key={index} className=\"bg-gray-200 text-black rounded-full px-2 py-0.5 text-xs\">\n                          {reaction.emoji} {reaction.emoji === 'ðŸ‘' ? reactions[msg.id].filter(r => r.emoji === 'ðŸ‘').length : ''}\n                        </span>\n                      ))}\n                    </div>\n                  )}\n                </div>\n                \n                {/* Message actions */}\n                {msg.sender_id === userId && (\n                  <div className=\"flex justify-end mt-1 space-x-2\">\n                    <button \n                      className=\"text-xs text-gray-500 hover:text-gray-700\"\n                      onClick={() => editMessage(msg)}\n                    >\n                      <FaEdit />\n                    </button>\n                    <button \n                      className=\"text-xs text-gray-500 hover:text-red-500\"\n                      onClick={() => deleteMessage(msg.id)}\n                    >\n                      <FaTrash />\n                    </button>\n                  </div>\n                )}\n                \n                {/* Add reaction button */}\n                <div className=\"flex justify-start mt-1\">\n                  <button \n                    className=\"text-xs text-gray-500 hover:text-blue-500\"\n                    onClick={() => addReaction(msg.id, 'ðŸ‘')}\n                  >\n                    <FaThumbsUp />\n                  </button>\n                </div>\n              </div>\n            ))\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Attachments Preview */}\n        {attachments.length > 0 && (\n          <div className=\"px-3 pt-2 bg-gray-100 flex gap-2 flex-wrap\">\n            {attachments.map((file, index) => (\n              <div key={index} className=\"relative bg-white p-1 rounded border flex items-center\">\n                <span className=\"text-xs truncate max-w-xs\">{file.name}</span>\n                <button \n                  className=\"ml-1 text-red-500\"\n                  onClick={() => removeAttachment(index)}\n                >\n                  <FaTrash size={10} />\n                </button>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Message Input */}\n        <div className=\"flex items-center p-3 border-t bg-white\">\n          <button \n            className=\"text-gray-500 p-2\"\n            onClick={() => fileInputRef.current?.click()}\n          >\n            <FaImage />\n            <input \n              type=\"file\" \n              className=\"hidden\" \n              ref={fileInputRef} \n              onChange={handleFileUpload}\n              multiple\n            />\n          </button>\n          \n          <input \n            type=\"text\" \n            className=\"flex-1 border p-2 rounded-md outline-none mx-2\" \n            placeholder={isEditing ? \"Edit your message...\" : \"Type a message...\"} \n            value={message} \n            onChange={(e) => setMessage(e.target.value)}\n            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\n          />\n          \n          <button \n            onClick={sendMessage} \n            className={`${\n              isEditing ? \"bg-yellow-600\" : \"bg-blue-600\"\n            } text-white p-2 rounded-md`}\n          >\n            <FaPaperPlane />\n          </button>\n        </div>\n      </div>\n\n      {/* Events & Newsletters */}\n      <div className=\"w-1/3 p-4 border-l bg-white overflow-y-auto\">\n        <h2 className=\"text-lg font-bold mb-4\">Events & Newsletters</h2>\n        \n        <div className=\"mb-4\">\n          <textarea \n            className=\"w-full border p-2 rounded\" \n            placeholder=\"Write something...\" \n            rows=\"4\"\n            value={postContent} \n            onChange={(e) => setPostContent(e.target.value)} \n          />\n          \n          <div className=\"flex gap-2 mb-2\">\n            <button \n              className={`flex-1 p-2 rounded ${postType === \"event\" ? \"bg-blue-600 text-white\" : \"bg-gray-200\"}`}\n              onClick={() => setPostType(\"event\")}\n            >\n              <FaCalendarAlt className=\"mr-2 inline\" /> Event\n            </button>\n            <button \n              className={`flex-1 p-2 rounded ${postType === \"newsletter\" ? \"bg-blue-600 text-white\" : \"bg-gray-200\"}`}\n              onClick={() => setPostType(\"newsletter\")}\n            >\n              <FaNewspaper className=\"mr-2 inline\" /> Newsletter\n            </button>\n          </div>\n          \n          <button \n            className=\"w-full bg-blue-600 text-white p-2 rounded\" \n            onClick={postUpdate}\n          >\n            Post\n          </button>\n        </div>\n        \n        <div className=\"space-y-4\">\n          {isLoading ? (\n            <div className=\"animate-pulse space-y-3\">\n              {[1, 2, 3].map(i => (\n                <div key={i} className=\"h-32 bg-gray-200 rounded-lg\"></div>\n              ))}\n            </div>\n          ) : filteredPosts.length === 0 ? (\n            <div className=\"text-center text-gray-500 py-4\">\n              No posts available {searchTerm && \"matching your search\"}\n            </div>\n          ) : (\n            filteredPosts.map((post) => (\n              <div key={post.id} className=\"border rounded-lg p-3 bg-gray-50\">\n                <div className=\"flex justify-between items-center mb-2\">\n                  <div className=\"flex items-center\">\n                    <div className=\"w-8 h-8 bg-gray-300 rounded-full mr-2 flex items-center justify-center\">\n                      {users.find(u => u.id === post.user_id)?.name.charAt(0).toUpperCase()}\n                    </div>\n                    <div>\n                      <p className=\"font-semibold\">{users.find(u => u.id === post.user_id)?.name}</p>\n                      <p className=\"text-xs text-gray-500\">\n                        {new Date(post.created_at).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </div>\n                  <span className={`text-xs px-2 py-1 rounded ${\n                    post.type === \"event\" ? \"bg-blue-100 text-blue-800\" : \"bg-green-100 text-green-800\"\n                  }`}>\n                    {post.type === \"event\" ? \"Event\" : \"Newsletter\"}\n                  </span>\n                </div>\n                <p className=\"whitespace-pre-line\">{post.content}</p>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Messages;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}